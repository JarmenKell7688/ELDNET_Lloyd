@model IEnumerable<ELDNET_Lloyd.Models.Activity>

@{
    Layout = "_AdminShared";
}

<div class="container-fluid mt-5 ms-0">
    <h2 class="mb-4 text-center">Activity Reservation Records</h2>

    <div class="table-responsive" style="max-width: 800px; margin: 0 auto;">
        <table class="table table-bordered table-striped table-sm">
            <thead class="text-center" style="background-color: #ff6600; color: white;">
                <tr>
                    <th style="width: 80px;">ID</th>
                    <th style="width: 120px;">Student ID</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody class="text-center">
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Id</td>
                            <td>@item.StudentId</td>
                            <td>
                                <button type="button" class="btn btn-sm me-1" style="background-color: #ff6600; color: white;"
                                        data-bs-toggle="modal" data-bs-target="#viewModal@(item.Id)">
                                    View
                                </button>
                                <form asp-action="Delete" asp-controller="ActivityRecords" asp-route-id="@item.Id" method="post" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this record?');">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>

                        <!-- Modal for viewing full details -->
                        <div class="modal fade" id="viewModal@(item.Id)" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header" style="background-color: #ff6600; color: white;">
                                        <h5 class="modal-title">Activity Details - ID: @item.Id</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Status Badge -->
                                        <div class="text-center mb-4">
                                            @{
                                                var status = string.IsNullOrEmpty(item.Status) ? "Pending" : item.Status;
                                            }
                                            @if (status == "Approved")
                                            {
                                                <span class="badge bg-success" style="font-size: 1.1rem; padding: 10px 20px;">✓ Approved</span>
                                            }
                                            else if (status == "Denied")
                                            {
                                                <span class="badge bg-danger" style="font-size: 1.1rem; padding: 10px 20px;">✗ Denied</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-warning text-dark" style="font-size: 1.1rem; padding: 10px 20px;">⏳ Pending</span>
                                            }
                                        </div>

                                        <h6 class="fw-bold mb-3">Activity Information</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <p><strong>Organization Name:</strong> @item.OrganizationName</p>
                                                <p><strong>Activity Title:</strong> @item.ActivityTitle</p>
                                                <p><strong>Venue:</strong> @item.Venue</p>
                                                <p><strong>Date Needed:</strong> @(item.DateNeeded?.ToString("MM/dd/yyyy"))</p>
                                                <p><strong>Time:</strong> @item.TimeFrom.ToString(@"hh\:mm") - @item.TimeTo.ToString(@"hh\:mm")</p>
                                                <p><strong>Participants:</strong> @item.Participants</p>
                                                <p><strong>Speaker:</strong> @item.Speaker</p>
                                            </div>
                                            <div class="col-md-6">
                                                <p><strong>Purpose:</strong> @item.Purpose</p>
                                                <p><strong>Equipment Needed:</strong> @item.EquipmentNeeded</p>
                                                <p><strong>Nature of Activity:</strong> @item.NatureOfActivity</p>
                                                <p><strong>Source of Funds:</strong> @item.SourceOfFunds</p>
                                                <p><strong>Created At:</strong> @item.CreatedAt.ToString("MM/dd/yyyy HH:mm")</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        @{
                                            var currentStatus = string.IsNullOrEmpty(item.Status) ? "Pending" : item.Status;
                                        }
                                        @if (currentStatus == "Pending")
                                        {
                                            <form asp-action="Approve" asp-controller="ActivityRecords" asp-route-id="@item.Id" method="post" style="display:inline;">
                                                <button type="submit" class="btn btn-success" onclick="return confirm('Approve this request?');">
                                                    Approve
                                                </button>
                                            </form>
                                            <form asp-action="Deny" asp-controller="ActivityRecords" asp-route-id="@item.Id" method="post" style="display:inline;">
                                                <button type="submit" class="btn btn-warning" onclick="return confirm('Deny this request?');">
                                                    Deny
                                                </button>
                                            </form>
                                        }
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="3" class="text-center">No records found</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>